# snowcover_products

The snow surface is quite straightforward to detect from high resolution optical imagery. Discriminating cloud and snow pixels is the challenging part in snow cover mapping. 

## Potential products for snowcover

| Data Source | Name | Spatial Resolution | Spatial Domain | Timeliness | Period | Link | More Info |
|-------------|------|--------------------|----------------|------------|--------|------|-----------|
| Copernicus Global Land Service | Fractional Snow Cover (FSC) and Gap-Filled Fractional Snow Cover (GFSC) | | | | | [Snow Cover](https://land.copernicus.eu/pan-european/biophysical-parameters/high-resolution-snow-and-ice-monitoring/snow-products/snow-cover) | Just provide information about the Sentinel-2 L1C and L2A products |
| EUMETSAT    | SN-OBS-1 (Snow detection (snow mask) by VIS/IR radiometry) | 1 to 5 km | ~Europe| 6h | mid-November 2007 - today | [Snow Products](https://hsaf.meteoam.it/Products/ProductsList?type=snow) | Format: HDF5 and PNG. Instrument: SEVIRI |
| EUMETSAT    | SN-OBS-3 (Effective snow cover by VIS/IR radiometry) | | ~EUROPE | | | | Instrument: AVHRR/3, **MODIS** | 
| VIIRS       | VNP10A1F (Snow Cover Cloud-Gap-Filled Daily L3 Global 375m SIN Grid) | 375m | Global | 1day | 19 January 2012 to present | [VNP10A1F](https://nsidc.org/data/vnp10a1f/versions/1) | Format: HDF-EOS5. Instrument: VIIRS |
| MODIS       | MOD10A1 (Terra) &	MYD10A1 (AQUA) (MODIS Snow Cover Daily L3 Global 500m Grid) | 500m | Global | | | [MODIS Snow Cover](https://modis.gsfc.nasa.gov/data/dataprod/mod10.php) | Instrument: MODIS |
| Sentinel-2  | 


## Algorithms

Most of the algorithms are based on the normalized-difference snow index (NDSI) and a digital elevation model

### Let-It-Snow 

LIS is based on the Normalized Difference Snow Index (NDSI).

This algorithm is described in Richiardi et al. (2021) and developed by Gascoin et al. (2018). The algorithm (Let-It-Snow revision) improves the discrimination between snow and cloud objects.

| | LIS | LIS revision (rLIS) |
|-|-----|--------------|
| preprocessing | MAJA algorithm (Lonjou et al., 2016) for both atmospheric/topographic correction and cloud mask extraction | Fmask algorithm and Sen2Cor processor |
|  subsequent processing phase | | New parameter, based on the reflectance in the SWIR, to better discriminate snow from clouds |
| | The original algorithm adopts a band down-sampling technique | Reduction of red-band noise is achieved by smoothing its values through a mean moving window |
| | The original LIS algorithm produces no output when restrictive threshold values are used for the NDSI, red band, and SWIR band, and a low amount of snow pixels are found (with respect to a defined quantitative threshold) | Regardless of the amount of snow detected, the proposed algorithm produces an output map |

LIS revision (rLIS):

- Fmask v4 for cloud detection (The cloud probability threshold was set to 40%, and the dilation parameters for clouds, cloud shadows, and snow were set to 1, 1, and 0 pixels, respectively).
-
-  The S2 L1C images were atmospherically and topographically corrected through Sen2Cor v2.5.5, using a high-resolution DEM, in order to improve the correction performance, thus obtaining the S2 Level 2A images.

#### Input data

1) An S2 L2A flattened surface bottom-of-atmosphere, in particular the green (band 3); red (band 4), and SWIR (band 11) bands.

| Bands |	Green |	Red	| SWIR |
|-------|-------|-----|------|
|Sentinel-2|	Band 3 (10 m, 0.560 µm) |	Band 4 (10 m, 0.665 µm) |	Band 11 (20 m, 1.610 µm) |

2) A cloud mask generated by Fmask

3) A Digital Elevation Model

#### Steps

1) DEM to S2 L2A spatial resolution

2) Calculate the NDSI, from the atmospheric and topographically corrected green and SWIR bands at 20 m resolution, as:

```
NDSI =green − SWIRgreen + SWIR
```
3) Search for possible snow-covered areas under "dark clouds" (thin and transparent clouds).

  - “cloud pass 1”: search for dark clouds among all the pixels classified as clouds by Fmask, excluding only the pixels classified a priori as cloud shadows
    -  The “dark clouds” can be identified through use of a threshold, rD, which is applied to the red band after reducing its noise through an average 3 × 3 moving window filter
    -  "dark clouds": pixels flagged as clouds in the Fmask cloud mask that respond in the red band with a signal greater than rD. Dark clouds are temporarily removed from the cloud mask, and are investigated for the possible presence of snow with the rest of the image. The pixels of the cloud with the red band reflectance lower than rD are excluded from further investigations.
  
  - "snow pass 1": the snow cover is identified by applying restrictive thresholds in order to minimize false snow detection. A pixel is classified as snow if the following conditions are fulfilled:
    - NDSI > n1
    - red band > r1
    - SWIR band < s1  
  -  if the snow detected in the entire image is greater than the threshold ft, the algorithm proceeds with the calculation of the snowline elevation; otherwise, it stops
  -  When the image is almost or totally cloudy, ft is not overcome and, therefore, the most restrictive step (i.e., “snow pass 1”) is maintained while the less restrictive one (i.e., “snow pass 2”) is skipped, in order to lower the likelihood of confusion between clouds and snow. 
  -  identify the snowline elevation:
    - calculating the percentage of snow present for each 100 m (dz) altitude band, with respect to the percentage of pixels free from clouds (fct), thus establishing the altitude limit below which the chance of snow is zero.
    - The snowline elevation (zs) is defined as two altitudinal bands below the minimum identified band (dmin) in which the snow that is present is greater than the threshold fs: zs = dmin − 2 · dz  
  - "snow pass 2": performe snow detection a second time, using less restrictive thresholds and introducing the previously identified altitude limit, zs.
    - a pixel is classified as snow if it meets the following conditions:
      - NDSI > n2;
      - red band > r2;
      - SWIR band < s2;
      - elevation > zs. 
      
- pixels that meet the conditions described above are now classified as snow. The remaining dark cloud pixels will return clouds (if they respond in the red band with a reflectance greater than the threshold rB) or are classified as “No snow,” otherwise.  
- reclassify “No snow” pixel clusters smaller than 5 pixels (equal to 2000 m2), based on the values of the neighboring cells, in order to eliminate any unreliable pixels from the final mask.
- **final output**: a 20 m resolution raster mask (Figure 5) following the LIS classification: 0, No snow; 100, Snow; 205, Cloud; 254, No Data.
 


## Notes

### Fmask v4 

Software for automated cloud, cloud shadow, snow, and water masking for Landsat 4–8 and Sentinel 2 images. Fmask has been distributed for both Windows and Linux, including standalone versions with or without a graphical user interface (GUI).

### MAJA (MACCS-ATCOR Joint Algorithm)

A multi-temporal cloud detection and topographic/atmospheric correction software package produced through the joint effort of CNES, CESBIO, and DLR.


### NDSI

The Normalized Difference Snow Index (NDSI) snow cover is an index that is related to the presence of snow in a pixel and is a more accurate description of snow detection as compared to Fractional Snow Cover (FSC). Snow typically has very high visible (VIS) reflectance and very low reflectance in the shortwave infrared (SWIR), a characteristic used to detect snow by distinguishing between snow and most cloud types. Snow cover is detected using the NDSI ratio of the difference in VIS and SWIR reflectance; NDSI = ((band 4-band 6) / (band 4 + band 6)). A pixel with NDSI > 0.0 is considered to have some snow present. A pixel with NDSI <= 0.0 is a snow free land surface (Riggs et al., 2016).   

NDSI introduced by Jeff Dozier (Rem. Sens. Env., 1989) 

:smiley: See [this useful page](https://labo.obs-mip.fr/multitemp/let-it-snow-development-of-an-operational-snow-cover-product-from-sentinel-2-and-landsat-8-data/).


## Slope-corrected surface reflectances 

Did I tell you that mountain regions are quite sloping? The slope correction enables to use the same detection thresholds in south-facing and north-facing slopes. 

## References

- [Let-It-Snow](https://zenodo.org/record/1414452#.ZG3MHKVBxaQ)

- More snow-cover products from EUMETSAT: [available here](https://hsaf.meteoam.it/Products/ProductsList?type=snow)

- Dozier, J. 1989. Spectral signature of alpine snow cover from the landsat thematic mapper. [Available here](https://www.sciencedirect.com/science/article/abs/pii/0034425789901016)

- Gascoin, S.; Grizonnet, M.; Klempka, T.; Salgues, G. Theia Land Data Centre Algorithm Theoritical Basis Documentation for an Operational Snow Cover Extent Product from Sentinel-2 and Landsat-8 Data (Let-It-Snow). 2018. [Available online](https://zenodo.org/record/1414452)

-  Lonjou, V.; Desjardins, C.; Hagolle, O.; Petrucci, B.; Tremas, T.; Dejus, M.; Makarau, A.; Auer, S. [MACCS-ATCOR joint algorithm (MAJA)](https://www.spiedigitallibrary.org/conference-proceedings-of-spie/10001/1/MACCS-ATCOR-joint-algorithm-MAJA/10.1117/12.2240935.short?SSO=1). Remote Sens. Clouds Atmos. XXI 2016, 10001, 1000107

- Richiardi, C. et al., 2021. A Revised Snow Cover Algorithm to Improve Discrimination between Snow and Clouds: A Case Study in Gran Paradiso National Park. Remote Sensing. (Available here)[https://www.mdpi.com/2072-4292/13/10/1957}


